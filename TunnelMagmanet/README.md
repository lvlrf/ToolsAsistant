# Backhaul Premium Bulk Config Generator

Ø§Ø¨Ø²Ø§Ø± Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ÛŒ Backhaul Premium Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ù‡Ù…Ù‡ transport Ù‡Ø§ Ùˆ Ø³Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ

---

## âœ¨ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§

### ğŸ¯ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„ Transport
- âœ… **13 Ù†ÙˆØ¹ transport:** tcp, tcpmux, utcpmux, xtcpmux, ws, wsmux, uwsmux, xwsmux, udp, tcptun, faketcptun, wstun, udptun
- âœ… **Mux Versions:** Ù†Ø³Ø®Ù‡ 1 Ùˆ 2 Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ mux transport Ù‡Ø§
- âœ… **TUN Support:** Ù…Ø¯ÛŒØ±ÛŒØª Ø®ÙˆØ¯Ú©Ø§Ø± subnet Ù‡Ø§ Ø¨Ø±Ø§ÛŒ TUN transports

### ğŸš€ Ø³Ù‡ Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ
- **Speed:** Ø¨Ø±Ø§ÛŒ Ø­Ø¯Ø§Ú©Ø«Ø± Ù¾Ù‡Ù†Ø§ÛŒ Ø¨Ø§Ù†Ø¯ Ùˆ Ø³Ø±Ø¹Øª
- **Stable:** Ø¨Ø±Ø§ÛŒ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø¯Ø± Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù¾Ø§ÛŒØ¯Ø§Ø±
- **Balanced:** ØªØ¹Ø§Ø¯Ù„ Ø¨ÛŒÙ† Ø³Ø±Ø¹Øª Ùˆ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ

### ğŸ“Š Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯
- Ù…Ø¯ÛŒØ±ÛŒØª Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ (tunnel, web, iperf)
- Ù…Ø¯ÛŒØ±ÛŒØª Ø®ÙˆØ¯Ú©Ø§Ø± subnet Ù‡Ø§ÛŒ TUN
- Token ÛŒÚ©ØªØ§ Ø¨Ø±Ø§ÛŒ Ù‡Ø± connection
- State management Ø¨Ø±Ø§ÛŒ Ø§Ø¬ØªÙ†Ø§Ø¨ Ø§Ø² ØªØ¯Ø§Ø®Ù„

### ğŸ›  Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú©Ø§Ù…Ù„
- Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÙˆÛŒØ³ (install, stop, restart, remove)
- Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø±ÙˆØ± (Iran & Kharej)
- State manager Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ Ø¢Ù¾Ø¯ÛŒØª

---

## ğŸ“‹ Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§

- Python 3.6+
- Ø¯Ø³ØªØ±Ø³ÛŒ SSH Ø¨Ù‡ Ø³Ø±ÙˆØ±Ù‡Ø§
- Ø¨Ø§ÛŒÙ†Ø±ÛŒ Backhaul Premium (ÙØ§ÛŒÙ„ ÙØ´Ø±Ø¯Ù‡ `.tar.gz`)

---

## ğŸš€ Ø´Ø±ÙˆØ¹ Ø³Ø±ÛŒØ¹

### Û±. ÙˆÛŒØ±Ø§ÛŒØ´ config.json

```json
{
  "iran_servers": [
    {"name": "Tehran-Main", "ip": "1.2.3.4"}
  ],
  
  "kharej_servers": [
    {"name": "Germany-Hetzner", "ip": "5.6.7.8"}
  ],
  
  "connections": [
    {
      "iran": "Tehran-Main",
      "kharej": "Germany-Hetzner",
      "transports": ["tcp", "tcpmux", "ws", "tcptun"]
    }
  ],
  
  "settings": {
    "profiles": ["speed", "stable", "balanced"]
  }
}
```

### Û². Ø§Ø¬Ø±Ø§ÛŒ Generator

```bash
python3 generator.py
```

Ø®Ø±ÙˆØ¬ÛŒ:
```
============================================================
Backhaul Premium Bulk Config Generator
============================================================

[OK] Tehran-Main -> Germany-Hetzner: tcp-speed (Port 100)
[OK] Tehran-Main -> Germany-Hetzner: tcp-stable (Port 101)
[OK] Tehran-Main -> Germany-Hetzner: tcp-balanced (Port 102)
[OK] Tehran-Main -> Germany-Hetzner: tcpmux-v1-speed (Port 103)
...

============================================================
[OK] Generated 36 configurations successfully!
Output directory: /path/to/output
State saved to: state.json
============================================================
```

### Û³. Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø¨Ø§ÛŒÙ†Ø±ÛŒ

```bash
# Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ ÙØ´Ø±Ø¯Ù‡ Ø¨Ù‡ Ø³Ø±ÙˆØ±Ù‡Ø§
scp backhaul_premium.tar.gz root@1.2.3.4:/root/backhaul-core/
scp backhaul_premium.tar.gz root@5.6.7.8:/root/backhaul-core/
```

### Û´. Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§

```bash
# Iran
scp output/Iran/Tehran-Main/*.toml root@1.2.3.4:/root/backhaul-core/
scp output/Iran/Tehran-Main/*.sh root@1.2.3.4:/root/backhaul-core/

# Kharej
scp output/Kharej/Germany-Hetzner/*.toml root@5.6.7.8:/root/backhaul-core/
scp output/Kharej/Germany-Hetzner/*.sh root@5.6.7.8:/root/backhaul-core/
```

### Ûµ. Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ø±ÙˆØ±Ù‡Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)

```bash
# Iran
ssh root@1.2.3.4 "cd /root/backhaul-core && bash optimize-iran.sh"

# Kharej
ssh root@5.6.7.8 "cd /root/backhaul-core && bash optimize-kharej.sh"
```

### Û¶. Ù†ØµØ¨ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§

```bash
# Iran
ssh root@1.2.3.4 "cd /root/backhaul-core && bash install-services.sh"

# Kharej
ssh root@5.6.7.8 "cd /root/backhaul-core && bash install-services.sh"
```

---

## ğŸ“ Ø³Ø§Ø®ØªØ§Ø± Ø®Ø±ÙˆØ¬ÛŒ

```
output/
â”œâ”€â”€ Iran/
â”‚   â””â”€â”€ Tehran-Main/
â”‚       â”œâ”€â”€ iran100-tcp-speed.toml
â”‚       â”œâ”€â”€ iran101-tcp-stable.toml
â”‚       â”œâ”€â”€ iran102-tcp-balanced.toml
â”‚       â”œâ”€â”€ iran103-tcpmux-v1-speed.toml
â”‚       â”œâ”€â”€ iran104-tcpmux-v1-stable.toml
â”‚       â”œâ”€â”€ iran105-tcpmux-v1-balanced.toml
â”‚       â”œâ”€â”€ iran106-tcpmux-v2-speed.toml
â”‚       â”œâ”€â”€ ... (Ù‡Ù…Ù‡ transport Ù‡Ø§ Ã— 3 Ù¾Ø±ÙˆÙØ§ÛŒÙ„)
â”‚       â”œâ”€â”€ install-services.sh
â”‚       â”œâ”€â”€ stop-services.sh
â”‚       â”œâ”€â”€ restart-services.sh
â”‚       â””â”€â”€ remove-services.sh
â”‚
â””â”€â”€ Kharej/
    â””â”€â”€ Germany-Hetzner/
        â”œâ”€â”€ kharej100-tcp-speed.toml
        â”œâ”€â”€ kharej101-tcp-stable.toml
        â”œâ”€â”€ ... (Ù‡Ù…Ù‡ transport Ù‡Ø§ Ã— 3 Ù¾Ø±ÙˆÙØ§ÛŒÙ„)
        â”œâ”€â”€ install-services.sh
        â”œâ”€â”€ stop-services.sh
        â”œâ”€â”€ restart-services.sh
        â””â”€â”€ remove-services.sh
```

---

## âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª config.json

### binary_config

```json
{
  "binary_config": {
    "premium": {
      "path": "/root/backhaul-core",
      "filename": "backhaul_premium"
    }
  }
}
```

### settings

```json
{
  "settings": {
    "tunnel_port_start": 100,
    "web_port_start": 800,
    "iperf_iran_port_start": 5001,
    "iperf_kharej_port": 5201,
    "excluded_ports": [22, 80, 443, 8080],
    "subnet_start": "10.10.10.0/24",
    "profiles": ["speed", "stable", "balanced"],
    "token_per_connection": true
  }
}
```

**Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§:**
- `tunnel_port_start`: Ù¾ÙˆØ±Øª Ø´Ø±ÙˆØ¹ ØªØ§Ù†Ù„â€ŒÙ‡Ø§
- `web_port_start`: Ù¾ÙˆØ±Øª Ø´Ø±ÙˆØ¹ Web Interface
- `iperf_iran_port_start`: Ù¾ÙˆØ±Øª Ø´Ø±ÙˆØ¹ iperf3 Ø¯Ø± Ø§ÛŒØ±Ø§Ù†
- `iperf_kharej_port`: Ù¾ÙˆØ±Øª iperf3 Ø¯Ø± Ø®Ø§Ø±Ø¬
- `excluded_ports`: Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆÙ†Ø¯
- `subnet_start`: Subnet Ø´Ø±ÙˆØ¹ Ø¨Ø±Ø§ÛŒ TUN transports
- `profiles`: Ù„ÛŒØ³Øª Ù¾Ø±ÙˆÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±
- `token_per_connection`: ÛŒÚ© token Ø¨Ø±Ø§ÛŒ Ù‡Ø± connection

### connections

```json
{
  "connections": [
    {
      "iran": "Tehran-Main",
      "kharej": "Germany-Hetzner",
      "transports": "all"
    }
  ]
}
```

**transports options:**
- `"all"`: Ù‡Ù…Ù‡ transport Ù‡Ø§
- `["tcp", "ws", ...]`: Ù„ÛŒØ³Øª Ø®Ø§Øµ

---

## ğŸ¯ Ù¾Ø±ÙˆÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ

### Speed Profile
```toml
channel_size = 4096
heartbeat = 20
mux_con = 128
connection_pool = 16
aggressive_pool = true
mtu = 1400
```

**Ø¨Ù‡ØªØ±ÛŒÙ† Ø¨Ø±Ø§ÛŒ:**
- Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ø³Ø±Ø¹Øª Ø¨Ø§Ù„Ø§
- Ù¾Ù‡Ù†Ø§ÛŒ Ø¨Ø§Ù†Ø¯ Ø¨Ø§Ù„Ø§
- Ø§Ø³ØªØ±ÛŒÙ… Ùˆ Ù…Ø­ØªÙˆØ§ÛŒ Ø³Ù†Ú¯ÛŒÙ†

### Stable Profile
```toml
channel_size = 2048
heartbeat = 40
mux_con = 64
connection_pool = 8
aggressive_pool = false
mtu = 1400
```

**Ø¨Ù‡ØªØ±ÛŒÙ† Ø¨Ø±Ø§ÛŒ:**
- Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù¾Ø§ÛŒØ¯Ø§Ø±
- Ø§ØªØµØ§Ù„Ø§Øª Ø¨Ù„Ù†Ø¯Ù…Ø¯Øª
- ØªØ§Ù†Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ù‡Ù…

### Balanced Profile
```toml
channel_size = 2048
heartbeat = 20
mux_con = 64
connection_pool = 8
aggressive_pool = false
mtu = 1400
```

**Ø¨Ù‡ØªØ±ÛŒÙ† Ø¨Ø±Ø§ÛŒ:**
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø±ÙˆØ²Ù…Ø±Ù‡
- ØªØ¹Ø§Ø¯Ù„ Ø³Ø±Ø¹Øª Ùˆ Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¹Ù…ÙˆÙ…ÛŒ

---

## ğŸ”§ Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§

### Ù„ÛŒØ³Øª Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§

```bash
systemctl list-units 'backhaul-iran*' --all
systemctl list-units 'backhaul-kharej*' --all
```

### Ù…Ø¯ÛŒØ±ÛŒØª ÛŒÚ© Ø³Ø±ÙˆÛŒØ³

```bash
# Ø§Ø³ØªØ§ØªÙˆØ³
systemctl status backhaul-iran100-tcp-speed

# Ø§Ø³ØªØ§Ø±Øª
systemctl start backhaul-iran100-tcp-speed

# Ø§Ø³ØªØ§Ù¾
systemctl stop backhaul-iran100-tcp-speed

# Ø±ÛŒâ€ŒØ§Ø³ØªØ§Ø±Øª
systemctl restart backhaul-iran100-tcp-speed

# Ù„Ø§Ú¯
journalctl -u backhaul-iran100-tcp-speed -f
```

### Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ù…Ù‡ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§

```bash
# Ø§Ø³ØªØ§Ù¾ Ù‡Ù…Ù‡
bash stop-services.sh

# Ø±ÛŒâ€ŒØ§Ø³ØªØ§Ø±Øª Ù‡Ù…Ù‡
bash restart-services.sh

# Ø­Ø°Ù Ù‡Ù…Ù‡
bash remove-services.sh
```

---

## ğŸ“Š Web Interface

Ù‡Ø± ØªØ§Ù†Ù„ ÛŒÚ© Web Interface Ø¯Ø§Ø±Ø¯ Ú©Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª real-time Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯:

```
http://SERVER_IP:800   # Ø§ÙˆÙ„ÛŒÙ† ØªØ§Ù†Ù„
http://SERVER_IP:801   # Ø¯ÙˆÙ…ÛŒÙ† ØªØ§Ù†Ù„
http://SERVER_IP:802   # Ø³ÙˆÙ…ÛŒÙ† ØªØ§Ù†Ù„
...
```

**Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙˆØ¬ÙˆØ¯:**
- ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„
- Transfer statistics
- Connection count
- Uptime

---

## ğŸ§ª ØªØ³Øª Ø¨Ø§ iperf3

### Ø±ÙˆÛŒ Kharej:

```bash
iperf3 -s -B 127.0.0.1 -p 5201
```

### Ø±ÙˆÛŒ Iran:

```bash
# ØªØ§Ù†Ù„ Ø§ÙˆÙ„
iperf3 -c 127.0.0.1 -p 5001 -t 30

# ØªØ§Ù†Ù„ Ø¯ÙˆÙ…
iperf3 -c 127.0.0.1 -p 5002 -t 30

# ØªØ§Ù†Ù„ Ø³ÙˆÙ…
iperf3 -c 127.0.0.1 -p 5003 -t 30
```

---

## ğŸ›  State Manager

Ø§Ø¨Ø²Ø§Ø± Ù…Ø¯ÛŒØ±ÛŒØª state.json:

```bash
# Ø­Ø§Ù„Øª ØªØ¹Ø§Ù…Ù„ÛŒ
python3 update-state.py

# Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡
python3 update-state.py summary

# Ù†Ù…Ø§ÛŒØ´ token Ù‡Ø§
python3 update-state.py tokens

# Ù†Ù…Ø§ÛŒØ´ config Ù‡Ø§
python3 update-state.py configs 50
```

---

## ğŸ“š Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ø¶Ø§ÙÛŒ

- [QUICKSTART.md](QUICKSTART.md) - Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø³Ø±ÛŒØ¹
- [TRANSPORTS-GUIDE.md](TRANSPORTS-GUIDE.md) - Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Transport Ù‡Ø§
- [PROFILES-GUIDE.md](PROFILES-GUIDE.md) - Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾Ø±ÙˆÙØ§ÛŒÙ„â€ŒÙ‡Ø§
- [OPTIMIZATION-GUIDE.md](OPTIMIZATION-GUIDE.md) - Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ
- [TROUBLESHOOTING.md](TROUBLESHOOTING.md) - Ø±ÙØ¹ Ù…Ø´Ú©Ù„Ø§Øª

---

## âš ï¸ Ù†Ú©Ø§Øª Ù…Ù‡Ù…

### Û±. Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„ Ø¨Ø§ÛŒÙ†Ø±ÛŒ

```bash
# âœ… Ø¯Ø±Ø³Øª
/root/backhaul-core/backhaul_premium
/root/backhaul-core/backhaul_premium.tar.gz

# âŒ Ø§Ø´ØªØ¨Ø§Ù‡
/root/backhaul_premium
/tmp/backhaul_premium
```

### Û². Subnet Ø¨Ø±Ø§ÛŒ TUN

- Ù‡Ø± TUN transport ÛŒÚ© subnet Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯ Ø¯Ø§Ø±Ø¯
- Subnet Ù‡Ø§ Ø¨Ø§ÛŒØ¯ Ø¯Ø± Iran Ùˆ Kharej ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§Ø´Ù†Ø¯
- ÙØ±Ù…Øª: `10.10.X.0/24` (X = 10, 20, 30, ...)

### Û³. Token

- Ù‡Ø± connection ÛŒÚ© token Ù…Ø´ØªØ±Ú© Ø¯Ø§Ø±Ø¯
- Iran Ùˆ Kharej Ù‡Ù…Ø§Ù† token Ø±Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯
- Token Ù‡Ø§ Ø¯Ø± state.json Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯

### Û´. Ù†Ø§Ù… Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§

Ø§Ù„Ú¯Ùˆ: `backhaul-{iran/kharej}{port}-{transport}-{profile}`

Ù…Ø«Ø§Ù„:
- `backhaul-iran100-tcp-speed`
- `backhaul-iran101-tcpmux-v2-stable`
- `backhaul-kharej100-tcp-speed`

---

## ğŸ› Ø±ÙØ¹ Ù…Ø´Ú©Ù„Ø§Øª

### Ø®Ø·Ø§: Service failed to start

```bash
# Ú†Ú© Ù„Ø§Ú¯
journalctl -u backhaul-iran100-tcp-speed -n 50

# Ú†Ú© config
cat /root/backhaul-core/iran100-tcp-speed.toml

# Ú†Ú© binary
ls -la /root/backhaul-core/backhaul_premium
```

### Ø®Ø·Ø§: Permission denied

```bash
chmod +x /root/backhaul-core/backhaul_premium
```

### Ø®Ø·Ø§: Port already in use

```bash
# Ú†Ú© Ù¾ÙˆØ±Øª
ss -tlnp | grep 100

# Ø¢Ù¾Ø¯ÛŒØª excluded_ports Ø¯Ø± config.json
```

---

## ğŸ“ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ùˆ Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´Ú©Ù„Ø§Øª:
- Telegram: @Gozar_XRay
- GitHub Issues

---

**Ù†Ø³Ø®Ù‡:** 1.0.0  
**ØªØ§Ø±ÛŒØ®:** 2026-01-05  
**Ø³Ø§Ø²Ú¯Ø§Ø± Ø¨Ø§:** Backhaul Premium v1.3.0+
