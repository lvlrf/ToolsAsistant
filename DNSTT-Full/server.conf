# slipstream Server Configuration
# نصب در: /etc/slipstream/server.conf
# سرور: خارج از ایران

# ===========================
# تنظیمات اصلی
# ===========================

# دامنه DNS که NS record بهش point شده
domain = "t.irihost.com"

# IP و پورت برای listen کردن
# باید روی UDP 53 listen کنه (DNS standard port)
listen_address = "0.0.0.0"
listen_port = 53

# ===========================
# تنظیمات QUIC
# ===========================

# کلید خصوصی سرور (باید generate بشه)
# دستور generate:
# openssl rand -hex 32
private_key = "REPLACE_WITH_YOUR_PRIVATE_KEY_HEX_64_CHARS"

# Maximum number of concurrent connections
max_connections = 100

# ===========================
# تنظیمات Tunnel Interface
# ===========================

# IP address برای tunnel interface (سمت سرور)
tunnel_address = "10.0.0.1"
tunnel_netmask = "255.255.255.0"

# MTU برای tunnel interface
# کمتر از MTU واقعی به خاطر overhead DNS/QUIC
tunnel_mtu = 1280

# ===========================
# تنظیمات Performance
# ===========================

# حداکثر query rate per second per resolver
# این عدد رو براساس محدودیت resolver ها تنظیم کن
max_query_rate = 50

# Buffer sizes (bytes)
send_buffer_size = 2097152    # 2MB
recv_buffer_size = 2097152    # 2MB

# Worker threads
# معمولاً برابر تعداد CPU cores
worker_threads = 16

# ===========================
# تنظیمات Congestion Control
# ===========================

# QUIC congestion control algorithm
# Options: cubic, bbr, reno
congestion_control = "bbr"

# Initial congestion window (packets)
initial_cwnd = 10

# ===========================
# تنظیمات Logging
# ===========================

# Log level: debug, info, warn, error
log_level = "info"

# Log file path (optional, اگر نخوای به file log کنه comment کن)
log_file = "/var/log/slipstream-server.log"

# Log to systemd journal
log_to_journal = true

# ===========================
# تنظیمات امنیتی
# ===========================

# فقط به این client ها اجازه اتصال بده (optional)
# اگر خالی بذاری، همه میتونن وصل شن
# allowed_clients = ["CLIENT_PUBLIC_KEY_1", "CLIENT_PUBLIC_KEY_2"]

# Rate limiting per client IP
rate_limit_per_ip = 100  # queries per second

# ===========================
# Advanced Settings
# ===========================

# Keep-alive interval (seconds)
keepalive_interval = 30

# Connection timeout (seconds)
connection_timeout = 120

# Retry attempts for failed packets
max_retries = 3

# Enable multipath QUIC
enable_multipath = true

# ===========================
# توضیحات مهم
# ===========================
#
# 1. حتماً private_key رو با یک کلید تصادفی عوض کن:
#    openssl rand -hex 32
#
# 2. domain باید دقیقاً همون چیزی باشه که NS record داری
#
# 3. worker_threads رو برابر تعداد CPU cores تنظیم کن
#
# 4. برای production، log_level رو به "warn" یا "error" تغییر بده
#
# 5. اگر firewall داری، UDP 53 رو باز کن:
#    ufw allow 53/udp
#
# ===========================

# End of configuration
