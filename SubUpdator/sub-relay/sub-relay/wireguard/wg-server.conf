# این فایل رو روی سرور خارج در مسیر /etc/wireguard/wg0.conf کپی کنید
# قبل از کپی، کلیدهای واقعی رو جایگزین کنید

[Interface]
# کلید خصوصی سرور (روی سرور خارج تولید میشه)
# برای تولید: wg genkey | tee server-private.key | wg pubkey > server-public.key
PrivateKey = SERVER_PRIVATE_KEY_HERE

# IP سرور در شبکه WireGuard
Address = ${WG_SERVER_IP}/24

# پورت گوش دهی
ListenPort = 51820

# فعال کردن IP forwarding (اجرا بعد از بالا آمدن interface)
PostUp = sysctl -w net.ipv4.ip_forward=1
PostUp = iptables -A FORWARD -i wg0 -j ACCEPT
PostUp = iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# غیرفعال کردن هنگام پایین آمدن
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT
PostDown = iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE

[Peer]
# کلید عمومی کلاینت (سرور ایران)
# این کلید رو از سرور ایران دریافت میکنید
PublicKey = CLIENT_PUBLIC_KEY_HERE

# IP های مجاز برای این peer
AllowedIPs = ${WG_CLIENT_IP}

# نگه داشتن اتصال زنده
PersistentKeepalive = 25

# توضیحات:
# ─────────────────────────────────────────────────
# 1. روی سرور خارج کلید بساز:
#    wg genkey | tee server-private.key | wg pubkey > server-public.key
#
# 2. کلید عمومی سرور رو در config.env سرور ایران قرار بده
#
# 3. روی سرور ایران کلید بساز:
#    wg genkey | tee client-private.key | wg pubkey > client-public.key
#
# 4. کلید عمومی کلاینت رو اینجا (CLIENT_PUBLIC_KEY_HERE) قرار بده
#
# 5. فایروال سرور خارج رو باز کن:
#    ufw allow 51820/udp
#
# 6. WireGuard رو فعال کن:
#    systemctl enable wg-quick@wg0
#    systemctl start wg-quick@wg0
#
# 7. تست اتصال از سرور ایران:
#    ping 10.66.66.1
